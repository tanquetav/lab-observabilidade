receivers:
  otlp:
    protocols:
      http: 
        endpoint: otel:4318
      grpc:
        endpoint: otel:4317

exporters:
  debug:
    verbosity: normal

#  logging:
#    loglevel: info
#  otlp/tempo:
#    endpoint: 192.168.8.2:24317
#    tls:
#      insecure: true
  otlp/elastic:
    endpoint: 172.17.0.1:31200
    headers:
      # Elastic APM Server secret token
      Authorization: "Bearer 1234"  
    tls:
      insecure: true

processors:
  batch:
  metricstransform:
    transforms:
    - include: jvm.memory.used
      action: insert
      new_name: system.memory.actual.free
    - include: jvm.memory.used
      action: insert
      new_name: system.memory.total
    - include: system.cpu.usage
      action: insert
      new_name: system.cpu.total.norm.pct
    - include: system.cpu.usage
      action: insert
      new_name: system.process.cpu.total.norm.pct

extensions:
  health_check:

service:
  extensions: [health_check]
  pipelines:
    traces:
      receivers: [otlp]
      processors: []
      #exporters: [otlp/tempo, otlp/elastic]
      exporters: [otlp/elastic]

    metrics:
      receivers: [otlp]
      #processors: [metricstransform]
      processors: []
      exporters: [otlp/elastic, debug]

    logs:
      receivers: [otlp]
      processors: []
      exporters: [otlp/elastic]
